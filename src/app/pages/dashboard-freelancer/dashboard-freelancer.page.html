<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Dashboard Freelancer</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="freelancer-dashboard ion-padding">

  <!-- Section Projets Disponibles -->
  <section class="section">
    <h2>üìã Projets disponibles</h2>
    
    <ion-spinner *ngIf="loadingProjects" name="dots"></ion-spinner>

    <div *ngIf="!loadingProjects && projects.length === 0" class="empty-state">
      <ion-icon name="briefcase-outline" size="large"></ion-icon>
      <p>Aucun projet disponible pour l'instant.</p>
    </div>

    <ion-card *ngFor="let project of projects" class="project-card">
      <ion-card-header>
        <ion-card-title>{{ project.name }}</ion-card-title>
        <ion-card-subtitle>
          <ion-chip color="primary" outline>
            <ion-label>Budget : {{ project.budget || 'N/A' }} ‚Ç¨</ion-label>
          </ion-chip>
          <ion-chip *ngIf="project.status" [color]="getStatusColor(project.status)" outline>
            <ion-label>{{ project.status }}</ion-label>
          </ion-chip>
        </ion-card-subtitle>
      </ion-card-header>
      
      <ion-card-content>
        <p class="project-description">{{ project.description }}</p>
        
        <ion-button expand="block" color="success" (click)="newProposal.projectId = project.id">
          ‚ú® Postuler √† ce projet
        </ion-button>
      </ion-card-content>
    </ion-card>
  </section>

  <!-- Formulaire de Proposition -->
  <section *ngIf="newProposal.projectId" class="proposal-form section">
    <h2>üì® Soumettre une proposition</h2>
    
    <ion-card>
      <ion-card-header>
        <ion-card-title>Projet : {{ getProjectName(newProposal.projectId) }}</ion-card-title>
      </ion-card-header>
      
      <ion-card-content>
        <ion-item>
          <ion-label position="stacked">Description de votre proposition *</ion-label>
          <ion-textarea 
            [(ngModel)]="newProposal.description" 
            rows="4"
            placeholder="D√©crivez votre approche, vos comp√©tences, et pourquoi vous √™tes le meilleur choix..."
            required>
          </ion-textarea>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Prix propos√© (‚Ç¨) *</ion-label>
          <ion-input 
            type="number" 
            [(ngModel)]="newProposal.price"
            placeholder="Montant de votre proposition"
            required>
          </ion-input>
        </ion-item>

        <div class="form-actions">
          <ion-button expand="block" color="success" [disabled]="submitting" (click)="submitProposal()">
            <ion-spinner *ngIf="submitting" name="dots"></ion-spinner>
            {{ submitting ? 'Envoi en cours...' : 'üì§ Envoyer la proposition' }}
          </ion-button>

          <ion-button expand="block" fill="clear" color="medium" 
                     (click)="newProposal = { projectId: '', description: '', price: '' }">
            ‚ùå Annuler
          </ion-button>
        </div>
      </ion-card-content>
    </ion-card>
  </section>

  <!-- Section Mes Propositions -->
  <section class="section my-proposals">
    <h2>üì¨ Mes propositions</h2>
    
    <ion-spinner *ngIf="loadingProposals" name="dots"></ion-spinner>

    <div *ngIf="!loadingProposals && proposals.length === 0" class="empty-state">
      <ion-icon name="document-text-outline" size="large"></ion-icon>
      <p>Vous n'avez encore soumis aucune proposition.</p>
    </div>

    <ion-card *ngFor="let p of proposals" class="proposal-card">
      <ion-card-header>
        <ion-card-title>{{ getProjectName(p.projectId) }}</ion-card-title>
        <ion-card-subtitle>
          <ion-chip [color]="getStatusColor(p.status)" outline>
            <ion-label>{{ p.status }}</ion-label>
          </ion-chip>
          <ion-chip color="primary" outline>
            <ion-label>{{ p.price }} ‚Ç¨</ion-label>
          </ion-chip>
        </ion-card-subtitle>
      </ion-card-header>
      
      <ion-card-content>
        <p class="proposal-description">{{ p.description }}</p>
        
        <div class="proposal-meta">
          <small>
            <ion-icon name="time-outline"></ion-icon>
            Envoy√© : {{ p.createdAt?.toDate ? (p.createdAt.toDate() | date:'short') : (p.createdAt | date:'short') }}
          </small>
        </div>
      </ion-card-content>
    </ion-card>
  </section>

  <!-- Section Projets Accept√©s -->
  <section class="section accepted-projects">
    <h2>‚úÖ Mes projets accept√©s</h2>
    
    <ion-spinner *ngIf="loadingAcceptedProjects" name="dots"></ion-spinner>

    <div *ngIf="!loadingAcceptedProjects && acceptedProjects.length === 0" class="empty-state">
      <ion-icon name="trophy-outline" size="large"></ion-icon>
      <p>Vous n'avez aucun projet accept√© pour le moment.</p>
      <p class="hint">Les projets accept√©s appara√Ætront ici automatiquement.</p>
    </div>

    <ion-card *ngFor="let project of acceptedProjects" class="accepted-project-card">
      <ion-card-header>
        <ion-card-title>{{ project.name }}</ion-card-title>
        <ion-card-subtitle>
          <ion-chip [color]="getStatusColor(project.status)" outline>
            <ion-label>{{ project.status || 'En cours' }}</ion-label>
          </ion-chip>
          <ion-chip color="primary" outline>
            <ion-label>Budget : {{ project.budget }} ‚Ç¨</ion-label>
          </ion-chip>
        </ion-card-subtitle>
      </ion-card-header>
      
      <ion-card-content>
        <p class="project-description">{{ project.description }}</p>
        
        <div class="project-details">
          <ion-item>
            <ion-label>
              <h3>üìÖ Date estim√©e de fin</h3>
              <p>{{ project.estimatedEndDate ? formatDate(project.estimatedEndDate) : 'Non d√©finie' }}</p>
            </ion-label>
            <ion-button slot="end" fill="outline" size="small" (click)="askEstimatedDate(project.id)">
              <ion-icon name="calendar-outline" slot="start"></ion-icon>
              D√©finir
            </ion-button>
          </ion-item>

          <ion-item>
            <ion-label>
              <h3>üí∞ Paiement</h3>
              <p>{{ project.paymentRequested ? 'Demand√© ‚úÖ' : 'Non demand√©' }}</p>
            </ion-label>
            <ion-button 
              slot="end" 
              color="success" 
              size="small" 
              (click)="requestPayment(project.id)" 
              [disabled]="project.paymentRequested">
              <ion-icon name="cash-outline" slot="start"></ion-icon>
              {{ project.paymentRequested ? 'D√©j√† demand√©' : 'Demander' }}
            </ion-button>
          </ion-item>
        </div>

        <div class="project-meta">
          <small *ngIf="project.assignedAt">
            <ion-icon name="time-outline"></ion-icon>
            Assign√© le : {{ project.assignedAt?.toDate ? (project.assignedAt.toDate() | date:'short') : (project.assignedAt | date:'short') }}
          </small>
        </div>
      </ion-card-content>
    </ion-card>
  </section>

</ion-content>